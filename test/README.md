# Guardian智能守护系统 - 测试数据生成器

## 📋 功能概述

这是一个专为Guardian智能守护系统设计的测试数据生成器，能够模拟完整的智能监控场景，从API调用到MQTT事件推送，提供一条龙的测试服务。

## 🚀 快速开始

### 启动测试数据生成器

```bash
# 基础启动
npm run test

# 开发模式（自动重启）
npm run test:dev

# 详细日志模式
npm run test:verbose
```

### 前置条件

1. **后端服务运行中**
   ```bash
   npm run serve
   ```

2. **数据库服务正常**
   - MySQL服务运行
   - 数据库表已创建

3. **MQTT服务器可访问**
   - 默认: `mqtt://localhost:1883`
   - 可通过环境变量配置

## 🎭 模拟数据内容

### 👥 测试用户

| 用户名 | 密码 | 角色 | 权限级别 |
|--------|------|------|----------|
| admin | admin123 | 超级管理员 | 3 |
| test1 | test123 | 管理员 | 2 |
| test2 | test123 | 基础用户 | 1 |
| test3 | test123 | 基础用户 | 1 |

### 🏠 守护圈配置

1. **家庭圈** (admin创建)
   - 温馨的家庭环境监控
   - 包含客厅、卧室、厨房等区域

2. **办公室圈** (test1创建)
   - 办公环境安全监控
   - 包含会议室、工作区等

3. **学校圈** (test2创建)
   - 校园安全监控
   - 包含教室、操场、食堂等

### 📱 设备类型

#### 🎥 智能摄像头
- **功能**: 实时监控、人脸识别、移动检测
- **事件**: 陌生人检测、移动检测、SOS报警
- **状态**: 录制状态、分辨率、夜视模式、电池电量

#### 🔍 智能传感器
- **功能**: 环境感知、异常检测
- **事件**: 移动检测、门窗开关
- **状态**: 激活状态、灵敏度、电池电量

#### 🚨 烟雾探测器
- **功能**: 火灾预警、烟雾检测
- **事件**: 烟雾检测、温度报警
- **状态**: 激活状态、灵敏度、自检时间

#### 🌡️ 环境监测器
- **功能**: 温湿度监测、空气质量
- **事件**: 温度报警、湿度异常
- **状态**: 温度、湿度、电池电量

## 📊 事件类型与权重

| 事件类型 | 权重 | 严重程度 | 描述 |
|----------|------|----------|------|
| 移动检测 | 40% | 低 | 最常见的监控事件 |
| 门窗开关 | 20% | 低 | 日常进出记录 |
| 陌生人检测 | 15% | 中 | 安全相关事件 |
| 温度报警 | 10% | 中 | 环境异常 |
| 跌倒检测 | 5% | 高 | 紧急安全事件 |
| SOS报警 | 3% | 严重 | 紧急求助 |
| 烟雾检测 | 3% | 高 | 火灾预警 |
| 设备离线 | 2% | 中 | 设备故障 |
| 电量不足 | 2% | 低 | 维护提醒 |

## 🔄 数据生成频率

- **事件生成**: 每5-15秒随机生成一个事件
- **设备心跳**: 每30-60秒发送一次心跳
- **状态更新**: 每2-5分钟更新一次设备状态
- **统计显示**: 每30秒显示一次实时统计

## 📡 MQTT消息格式

### 事件消息
```
主题: guardian/circle/{circle_id}/device/{device_sn}/event/{event_type}
负载: {
  "timestamp": "2024-01-01T12:00:00.000Z",
  "device_sn": "CAM001",
  "event_type": "motion_detected",
  "data": {
    "motion_area": 35,
    "location": { "x": 640, "y": 480 },
    "image": "data:image/jpeg;base64,/9j/4AAQ...",
    "severity": "low"
  }
}
```

### 心跳消息
```
主题: guardian/circle/{circle_id}/device/{device_sn}/heartbeat
负载: {
  "timestamp": "2024-01-01T12:00:00.000Z",
  "device_sn": "CAM001",
  "firmware_version": "v2.1.0",
  "status": "online"
}
```

### 状态消息
```
主题: guardian/circle/{circle_id}/device/{device_sn}/state
负载: {
  "timestamp": "2024-01-01T12:00:00.000Z",
  "device_sn": "CAM001",
  "state": {
    "recording": true,
    "resolution": "1080p",
    "battery_level": 85,
    "storage_used": 45
  }
}
```

## 🖼️ Base64图片支持

测试生成器会为视觉相关事件自动生成Base64格式的模拟图片：

- **格式**: `data:image/jpeg;base64,{base64_data}`
- **尺寸**: 100x100像素的彩色方块
- **颜色**: 随机生成
- **用途**: 模拟摄像头捕获的图像数据

## 📈 实时监控

### 控制台输出
- 🚀 启动信息和环境配置
- 📝 用户登录状态
- 🏠 守护圈创建进度
- 📱 设备绑定状态
- 🔌 MQTT连接状态
- 🎭 实时事件生成
- 📊 30秒统计报告

### 统计信息
```
📊 实时统计 (最近30秒):
   • 事件生成: 12 条
   • 心跳发送: 8 次
   • 状态更新: 3 次
   • 活跃设备: 12 台
   • 守护圈数: 3 个
   ⏰ 2024-01-01 12:00:00
```

## 🛠️ 故障排除

### 常见问题

1. **连接失败**
   ```
   ❌ 检查后端服务是否运行 (npm run serve)
   ❌ 确认数据库连接正常
   ❌ 验证网络连接
   ```

2. **MQTT连接失败**
   ```
   ❌ 检查MQTT服务器状态
   ❌ 确认端口1883是否开放
   ❌ 验证环境变量配置
   ```

3. **数据生成异常**
   ```
   ❌ 检查设备是否成功绑定
   ❌ 确认守护圈创建成功
   ❌ 查看错误日志详情
   ```

### 调试模式

```bash
# 启用详细日志
DEBUG=* npm run test

# 或使用预设命令
npm run test:verbose
```

## 🔧 配置选项

### 环境变量

```env
# API服务器配置
API_BASE_URL=http://localhost:3000

# MQTT服务器配置
MQTT_BROKER_URL=mqtt://localhost:1883
MQTT_USERNAME=
MQTT_PASSWORD=

# 数据库配置
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=
DB_NAME=guardian
```

### 自定义配置

可以通过修改 `mockDataGenerator.js` 中的配置来调整：

- 测试用户数据
- 守护圈配置
- 设备类型和数量
- 事件生成频率
- MQTT主题格式

## 📝 使用建议

1. **开发测试**: 使用 `npm run test:dev` 进行开发调试
2. **演示展示**: 使用 `npm run test` 进行稳定演示
3. **问题诊断**: 使用 `npm run test:verbose` 查看详细日志
4. **长期运行**: 建议配合进程管理工具如PM2使用

## 🎯 预期效果

启动测试数据生成器后，您应该能在前端看到：

- ✅ 实时更新的设备状态
- ✅ 持续生成的监控事件
- ✅ 动态变化的告警信息
- ✅ 完整的数据流展示
- ✅ 稳定运行的监控效果

这将展现出一个完整、稳定、功能丰富的智能守护监控系统！